#!/bin/bash

KVM=`which kvm`
if [ "$KVM" == "" ]; then
    KVM=`which qemu-kvm`
    if [ "$KVM" == "" ]; then
        echo "ERROR: kvm ist not installed on this system !" | logger
        exit 1
    fi
fi
# source the component config files
VM_CONF_DIR=`dirname $0`
VM_CONF_DIR=`cd $VM_CONF_DIR && pwd && cd - 1>/dev/null`
VM_NAME=`basename $VM_CONF_DIR`
. $VM_CONF_DIR/ram
. $VM_CONF_DIR/disk1
. $VM_CONF_DIR/disk2
. $VM_CONF_DIR/disk3
. $VM_CONF_DIR/disk4
. $VM_CONF_DIR/net1
. $VM_CONF_DIR/net2
. $VM_CONF_DIR/net3
. $VM_CONF_DIR/net4
. $VM_CONF_DIR/vnc
. $VM_CONF_DIR/boot


KVM_VM_DISK="$KVM_VM_DISK_1 $KVM_VM_DISK_2 $KVM_VM_DISK_3 $KVM_VM_DISK_4"
KVM_VM_NET="$KVM_VM_NET_1 $KVM_VM_NET_2 $KVM_VM_NET_3 $KVM_VM_NET_4"

echo "KVM vm $VM_NAME starting up ..." | logger
screen -dmS $KVM_VM_MAC_1 $KVM $KVM_VM_DISK -m $KVM_VM_RAM $KVM_VM_BOOT $KVM_VM_NET -vnc $KVM_VM_VNC